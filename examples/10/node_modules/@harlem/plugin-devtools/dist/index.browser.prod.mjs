var g="plugin:devtools",c="harlem",u="$all",H={label:"Harlem",color:4244621},T={set:"plugin:devtools:set"};import{EVENTS as p}from"@harlem/core";import{setupDevtoolsPlugin as k}from"@vue/devtools-api";function h(e,t){return e.localeCompare(t)}function E(e,t){return r=>{let{app:n,inspectorId:s}=r;if(n!==e||s!==c||t.size===0)return;let o=Array.from(t.keys()).sort(h).map(a=>({id:a,label:a}));r.rootNodes=[{children:o,id:u,label:"Stores"}]}}function O(e){try{return e()}catch(t){return"Failed to compute value..."}}function D(e){return Object.entries(e.registrations).reduce((t,[r,n])=>(t[r]=Array.from(n).sort(([s],[o])=>h(s,o)).map(([s,{type:o,producer:a}])=>({key:s,value:O(a),editable:!1,objectType:o})),t),{state:[{key:e.name,value:e.state,editable:!0,objectType:"reactive"}]})}function P(e){return e.reduce((t,r)=>{if(!r)return t;let n=D(r);return Object.entries(n).reduce((s,[o,a])=>(s[o]=(s[o]||[]).concat(a),s),{})},{})}function y(e,t){return r=>{let{app:n,inspectorId:s,nodeId:o}=r;if(n!==e||s!==c||t.size===0)return;let a=[t.get(o)||t.values().next().value];o===u&&(a=Array.from(t.values())),a.length>0&&(r.state=P(a))}}function A(e,t){return r=>{let{app:n,inspectorId:s,nodeId:o,path:a,state:d,set:m}=r;if(n!==e||s!==c||t.size===0)return;let I=a.shift(),i=o===u&&I||o,l=t.get(i);!l||l.write(T.set,g,S=>m(S,a,d.value))}}function v(e,t){return r=>{if(!r)return;let{store:n}=r;e.sendInspectorState(c),e.addTimelineEvent({layerId:c,event:{logType:t,title:"Mutation",subtitle:n,groupId:n,time:e.now(),data:r,meta:{store:n}}})}}function b(e){let{label:t,color:r}={...H,...e};return(n,s,o)=>{let a=E(n,o),d=y(n,o),m=A(n,o);k({app:n,label:t,id:c,logo:"https://harlemjs.com/assets/images/favicon.png",homepage:"https://harlemjs.com",packageName:"@harlem/plugin-devtools"},i=>{let l=v(i),S=v(i,"error");i.addInspector({label:t,id:c,icon:"source",treeFilterPlaceholder:"Search stores",stateFilterPlaceholder:"Search state",nodeActions:[{icon:"replay",tooltip:"Reset store",action:f=>s.emit(p.devtools.reset,{sender:g,store:f,data:f})}]}),i.addTimelineLayer({label:t,color:r,id:c,skipScreenshots:!0}),i.on.getInspectorTree(a),i.on.getInspectorState(d),i.on.editInspectorState(m),s.on(p.mutation.success,l),s.on(p.mutation.error,S),s.on(p.devtools.update,()=>{i.sendInspectorTree(c),i.sendInspectorState(c)})})}}export{b as default};
